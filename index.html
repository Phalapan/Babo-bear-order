<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>เลือกเมนูอาหาร</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .menu-button, .topping-button {
      margin: 5px; padding: 10px 15px;
      background-color: #007bff; color: white;
      border: none; border-radius: 5px; cursor: pointer;
    }
    .menu-button:hover, .topping-button:hover {
      background-color: #0056b3;
    }
    .clear-button { background-color: #dc3545; }
    .done-button { background-color: #28a745; }
    table { margin-top: 20px; border-collapse: collapse; width: 100%; }
    td, th { border: 1px solid #ccc; padding: 8px; text-align: center; }
    .section-title { margin-top: 40px; }
    #toppingSection { margin-top: 20px; }
  </style>
</head>
<body>

  <h2>เมนูแนะนำ</h2>
  <div id="menuList">
    <button class="menu-button" onclick="selectBaseMenu('หมีคำราม', 60)">หมีคำราม (60฿)</button>
    <button class="menu-button" onclick="selectBaseMenu('นมหมีคำราม', 60)">นมหมีคำราม (60฿)</button>
    <button class="menu-button" onclick="selectBaseMenu('โกโก้ชีส', 60)">โกโก้ชีส (60฿)</button>
    <button class="menu-button" onclick="selectBaseMenu('ไมโลชีส', 60)">ไมโลชีส (60฿)</button>
  </div>
  <h2>ชานม</h2>
  <div id="menuList">
    <button class="menu-button" onclick="selectBaseMenu('ชานมไต้หวัน', 40)">ชานมไต้หวัน (40฿)</button>
    <button class="menu-button" onclick="selectBaseMenu('ชานมเผือก', 50)">ชานมเผือก (50฿)</button>
    <button class="menu-button" onclick="selectBaseMenu('ชานมสตอเบอรี่', 50)">ชานมสตอเบอรี่ (50฿)</button>
    <button class="menu-button" onclick="selectBaseMenu('ชาเขียว', 50)">ชาเขียว (50฿)</button>
    <button class="menu-button" onclick="selectBaseMenu('ชานมคาปู', 50)">ชานมคาปู (50฿)</button>
    <button class="menu-button" onclick="selectBaseMenu('ชานมน้ำผึ้ง', 50)">ชานมน้ำผึ้ง (50฿)</button>
  </div>

  <div id="toppingSection" style="display:none;">
    <h3>เลือก Topping สำหรับ <span id="selectedBaseName"></span></h3>
    <button class="topping-button" onclick="confirmMenu('+ ไข่มุก', 0)">ไข่มุก (+0฿)</button>
    <button class="topping-button" onclick="confirmMenu('+ ชีส', 15)">ชีส (+15฿)</button>
    <button class="topping-button" onclick="confirmMenu('', 0)">ไม่ใส่ Topping</button>
  </div>

  <h2 class="section-title">เมนู "กำลังทำ"</h2>
  <table id="selectedTable">
    <thead>
      <tr>
        <th>ลำดับ</th>
        <th>ชื่อเมนู</th>
        <th>ราคา (฿)</th>
        <th>ดำเนินการ</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="totalPrice">รวมทั้งหมด: 0 บาท</div>
  <button class="menu-button clear-button" onclick="clearAll()">ล้างทั้งหมด</button>

  <h2 class="section-title">รายการที่เสร็จแล้ว</h2>
  <table id="doneTable">
    <thead>
      <tr>
        <th>ลำดับ</th>
        <th>ชื่อเมนู</th>
        <th>ราคา (฿)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <div id="doneTotal">รวมรายวัน: 0 บาท</div>
  <button class="menu-button clear-button" onclick="clearDoneAndSummarize()">สรุปยอด</button>

  <script>
    let selectedMenus = [];
    let doneMenus = [];
    let currentBaseMenu = null;

    const todayKey = 'menus_' + new Date().toISOString().split('T')[0];
    const doneKey = todayKey + '_done';

    window.onload = () => {
      const saved = localStorage.getItem(todayKey);
      if (saved) selectedMenus = JSON.parse(saved);

      const done = localStorage.getItem(doneKey);
      if (done) doneMenus = JSON.parse(done);

      renderTables();
    };

    function selectBaseMenu(name, price) {
      currentBaseMenu = { name, price };
      document.getElementById("selectedBaseName").textContent = name;
      document.getElementById("toppingSection").style.display = "block";
    }

    function confirmMenu(toppingText, toppingPrice) {
      if (!currentBaseMenu) return;

      const fullName = currentBaseMenu.name + (toppingText ? ' ' + toppingText : '');
      const fullPrice = currentBaseMenu.price + toppingPrice;

      selectedMenus.push({ name: fullName, price: fullPrice });
      currentBaseMenu = null;

      document.getElementById("toppingSection").style.display = "none";
      saveToStorage();
      renderTables();
    }

    function markAsDone(index) {
      const item = selectedMenus.splice(index, 1)[0];
      doneMenus.push(item);
      saveToStorage();
      renderTables();
    }

    function clearAll() {
      if (confirm("ล้างรายการ 'กำลังทำ' ทั้งหมด?")) {
        selectedMenus = [];
        saveToStorage();
        renderTables();
      }
    }

    function clearDoneAndSummarize() {
      const total = doneMenus.reduce((sum, item) => sum + item.price, 0);
      alert("สรุปยอดรายวัน: " + total + " บาท");
      doneMenus = [];
      saveToStorage();
      renderTables();
    }

    function saveToStorage() {
      localStorage.setItem(todayKey, JSON.stringify(selectedMenus));
      localStorage.setItem(doneKey, JSON.stringify(doneMenus));
    }

    function renderTables() {
      const tbody = document.querySelector("#selectedTable tbody");
      const tbodyDone = document.querySelector("#doneTable tbody");
      tbody.innerHTML = "";
      tbodyDone.innerHTML = "";

      let total = 0;
      selectedMenus.forEach((item, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${index + 1}</td>
          <td>${item.name}</td>
          <td>${item.price}</td>
          <td><button class="done-button" onclick="markAsDone(${index})">เสร็จ</button></td>`;
        tbody.appendChild(row);
        total += item.price;
      });
      document.getElementById("totalPrice").textContent = `รวมทั้งหมด: ${total} บาท`;

      let doneTotal = 0;
      doneMenus.forEach((item, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${index + 1}</td><td>${item.name}</td><td>${item.price}</td>`;
        tbodyDone.appendChild(row);
        doneTotal += item.price;
      });
      document.getElementById("doneTotal").textContent = `รวมรายวัน: ${doneTotal} บาท`;
    }
  </script>

</body>
</html>
